import{x as l,ej as m,u as g,dM as h,ek as p}from"./BKjTAV26.js";import{u as S}from"./CNJuuRFD.js";import{u as d}from"./Bx7TRS-Q.js";import{u as A}from"./BW5v7ni-.js";import{u as R}from"./DpdxWg4J.js";const D=()=>{const t=l({account:"",password:"",remember:!1}),e=m(),s=g(),r=S(),a=d(),u=A(),n=R(),f=h().public.apiUrl;return{loginForm:t,login:async()=>{var i,c;try{const o=await $fetch(`${f}/api/users/login`,{method:"POST",body:{account:t.account,password:t.password,platform_type:"Supplier"}});if(o&&o.data&&o.data.user){let y;s.setUser(o.data.user),console.log("登录成功",o.data.user),console.log("用户角色",(i=s.userData)==null?void 0:i.permissions),s.startAutoRefresh(),u.startAutoRefresh(),r.startAutoRefresh(),a.startAutoRefresh(),n.startAutoRefresh(),await p(e[(c=s.userData)==null?void 0:c.permissions])}}catch(o){console.error("登录失败",o)}},logout:async()=>{s.stopAutoRefresh(),u.stopAutoRefresh(),r.stopAutoRefresh(),a.stopAutoRefresh(),n.stopAutoRefresh(),await p(e.login)}}};export{D as u};
