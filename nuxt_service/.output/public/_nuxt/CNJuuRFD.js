import{dL as b,r as d,u as C,i as r,dM as _,dN as P}from"./BKjTAV26.js";var o=(a=>(a.Pending="Pending",a.Completed="Completed",a.Delayed="Delayed",a.InProgress="InProgress",a.AwaitingApproval="AwaitingApproval",a.Rejected="Rejected",a))(o||{});const R=b("task",()=>{const l=_().public.apiUrl,s=d([]),n=d(null),v=C(),g=d([{id:100,title:"齿轮箱协同设计",version:"1.0",status:o.Completed,approverId:1,responsibleId:1,dueDate:Date.now(),description:"完成了齿轮箱的初步设计和方案验证，相关人员已审核通过。",attachments:"gearbox_design_specifications_v1.pdf",createdAt:"2022-01-01T12:00:00",updatedAt:"2022-01-02T12:00:00"},{id:101,title:"活塞协同设计",version:"2.0",status:o.InProgress,approverId:2,responsibleId:1,dueDate:Date.now()+36e5,description:"活塞组件的设计草案已完成，待相关负责人进行审核。",attachments:"piston_design_draft_v2.pdf",createdAt:"2022-01-02T12:00:00",updatedAt:"2022-01-02T12:30:00"},{id:102,title:"水箔协同设计",version:"3.0",status:o.Delayed,approverId:3,responsibleId:1,dueDate:Date.now()-36e5,description:"水箔设计的交付进度已延迟，相关技术难点待解决。",attachments:"waterfoil_design_report_v3.pdf",createdAt:"2022-01-03T12:00:00",updatedAt:"2022-01-03T12:15:00"}]);function c(e){s.value=e}function p(){s.value=[]}const h=r(()=>s.value),m=r(()=>s.value.filter(e=>e.status!==o.Completed)),w=r(()=>s.value.filter(e=>e.status===o.Completed)),A=r(()=>e=>s.value.find(t=>t.id===e));async function u(){var e;try{const t=await fetch(`${l}/api/tasks/by-responseible?responsibleId=${(e=v.userData)==null?void 0:e.id}`,{method:"GET"});if(!t.ok)throw new Error("Failed to fetch all tasks");const i=await t.json();c(i),g.value.forEach(f=>{s.value.some(k=>k.id===f.id)||s.value.push(f)})}catch(t){console.error(t)}}function I(e=3e3){u(),n.value=P(u,e)}function y(){n.value!==null&&(clearInterval(n.value),n.value=null,p())}function T(e){return s.value.find(t=>t.id===e)}async function D(e){try{e.status=o.AwaitingApproval,e.platformType="Intranet",console.log(e);const t=await fetch(`${l}/api/tasks/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Failed to create task");const i=await t.json();s.value.push(i)}catch(t){console.error(t)}}return{tasksData:h,CompletedtasksData:w,unCompletedtasksData:m,getTask:A,getTaskById:T,createTask:D,setTasks:c,resetTasks:p,startAutoRefresh:I,stopAutoRefresh:y}},{persist:!0});export{R as u};
