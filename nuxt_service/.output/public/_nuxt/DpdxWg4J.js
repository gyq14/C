import{dL as k,r as c,u as A,i as p,dM as O,dN as j}from"./BKjTAV26.js";var r=(i=>(i.Pending="Pending",i.Completed="Completed",i.Delayed="Delayed",i.InProgress="InProgress",i.AwaitingApproval="AwaitingApproval",i.Rejected="Rejected",i))(r||{});const N=k("subtask",()=>{const u=O().public.apiUrl,a=c([]),o=c(null);A();const v=c([{id:200,taskId:100,title:"齿轮箱协同设计",version:"v1.0",status:r.InProgress,approverId:3,responsibleId:8,dueDate:new Date("2024-03-20").getTime(),description:"齿轮箱协同设计，相关设计和验证进行中。",attachments:[],data:JSON.stringify({supplier:"中车戚墅堰机车车辆工艺研究所股份有限公司",projectStatus:"进行中"}),createdAt:new Date("2024-03-10").toISOString(),updatedAt:new Date().toISOString()},{id:201,taskId:100,title:"齿轮箱强度计算",version:"v1.1",status:r.Pending,approverId:3,responsibleId:0,dueDate:new Date("2024-04-15").getTime(),description:"强度计算待开始。",attachments:[],data:JSON.stringify({supplier:"中车戚墅堰机车车辆工艺研究所股份有限公司",projectStatus:"待开始"}),createdAt:new Date("2024-03-25").toISOString(),updatedAt:new Date().toISOString()},{id:202,taskId:100,title:"齿轮箱机加工工艺分析",version:"v1.0",status:r.Pending,approverId:1,responsibleId:0,dueDate:new Date("2024-04-20").getTime(),description:"分析待开始。",attachments:[],data:JSON.stringify({supplier:"中车戚墅堰机车车辆工艺研究所股份有限公司",projectStatus:"待开始"}),createdAt:new Date("2024-04-08").toISOString(),updatedAt:new Date().toISOString()},{id:203,taskId:100,title:"类似结构齿轮箱问题反馈",version:"v1.2",status:r.Pending,approverId:1,responsibleId:0,dueDate:new Date("2024-04-30").getTime(),description:"类似结构问题待反馈。",attachments:[],data:JSON.stringify({supplier:"中车戚墅堰机车车辆工艺研究所股份有限公司",projectStatus:"待开始"}),createdAt:new Date("2024-04-20").toISOString(),updatedAt:new Date().toISOString()},{id:204,taskId:100,title:"齿轮箱初步设计方案评审",version:"1.0",status:r.Completed,approverId:1,responsibleId:9,dueDate:new Date("2022-01-01T18:00:00").getTime(),description:"初步设计方案评审已完成，获得批准。",attachments:["gearbox_design_specifications_v1_review.pdf"],data:JSON.stringify({supplier:"中车戚墅堰机车车辆工艺研究所股份有限公司",projectStatus:"已完成"}),createdAt:"2022-01-01T12:00:00",updatedAt:"2022-01-01T18:00:00"},{id:205,taskId:100,title:"齿轮箱设计文档整理",version:"1.1",status:r.InProgress,approverId:1,responsibleId:4,dueDate:new Date("2022-01-02T14:00:00").getTime(),description:"文档整理进行中，预计在审核前完成。",attachments:["gearbox_design_draft_v1.pdf"],data:JSON.stringify({supplier:"中车戚墅堰机车车辆工艺研究所股份有限公司",projectStatus:"进行中"}),createdAt:"2022-01-01T12:30:00",updatedAt:"2022-01-02T12:30:00"},{id:206,taskId:101,title:"活塞设计审核准备",version:"2.0",status:r.Pending,approverId:2,responsibleId:0,dueDate:new Date("2022-01-02T15:00:00").getTime(),description:"设计草案已完成，待审核。",attachments:["piston_design_draft_v2_review.pdf"],data:JSON.stringify({supplier:"中车戚墅堰机车车辆工艺研究所股份有限公司",projectStatus:"进行中"}),createdAt:"2022-01-02T12:00:00",updatedAt:"2022-01-02T12:30:00"},{id:207,taskId:102,title:"水箔设计进度报告",version:"3.0",status:r.Delayed,approverId:1,responsibleId:2,dueDate:new Date("2022-01-03T18:00:00").getTime(),description:"设计进度延迟，等待解决技术难点。",attachments:["waterfoil_design_delay_report_v3.pdf"],data:JSON.stringify({supplier:"中车戚墅堰机车车辆工艺研究所股份有限公司",projectStatus:"延迟"}),createdAt:"2022-01-03T12:00:00",updatedAt:"2022-01-03T12:15:00"}]);function d(e){a.value=e}function l(){a.value=[]}const I=p(()=>a.value.filter(e=>e.status!==r.Completed)),S=p(()=>a.value.filter(e=>e.status===r.Completed)),w=p(()=>e=>a.value.find(t=>t.id===e)),m=p(()=>e=>a.value.filter(t=>t.taskId===e));async function f(){try{v.value.forEach(e=>{a.value.some(t=>t.id===e.id)||a.value.push(e)})}catch(e){console.error(e)}}function D(e=3e3){f(),o.value=j(f,e)}function y(){o.value!==null&&(clearInterval(o.value),o.value=null,l())}async function h(e){try{const t=await fetch(`${u}/api/subtasks/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Failed to create subtask");const s=await t.json();if(s)return d([...a.value,s]),s}catch(t){console.error(t)}}async function T(e,t){try{const s=await fetch(`${u}/api/subtasks/update-task`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({subtaskId:e,...t})});if(!s.ok)throw new Error("Failed to update subtask");const n=await s.json();if(n)return d(a.value.map(g=>g.id===e?n:g)),n}catch(s){console.error(s)}}async function b(e){try{const t=await fetch(`${u}/api/subtasks/subtask.delete`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(!t.ok)throw new Error("Failed to delete subtask");const s=await t.json();if(s)return d(a.value.filter(n=>n.id!==e)),s}catch(t){console.error(t)}}return{subtasks:a,setSubtasks:d,resetSubtasks:l,startAutoRefresh:D,stopAutoRefresh:y,createSubtask:h,updateSubtask:T,deleteSubtask:b,unCompletedsubtaskData:I,CompletedsubtaskData:S,getSubtask:w,getSubtasksBytaskId:m}},{persist:!0});export{r as S,N as u};
